(window.webpackJsonp=window.webpackJsonp||[]).push([[69],{295:function(e,t,i){"use strict";i.r(t);var n=i(779),s=i.n(n),o=i(780),a=i.n(o),r=i(1),c=i.n(r),h=i(5),u=i.n(h),d=i(2),g=i.n(d),l=i(4),v=i(803),p=i(45),w=i(807),f=(i(985),i(791)),m=function(e){return e.find(".owl-item:not(.cloned)>.component").get().map((function(e){return c()(e).attr("data-cms-id")}))},C=function(){function e(t,i,n,o){s()(this,e),this.$ugcReviews=t,this.config=i,this.$ugcReviewContainer=t.find(".js-container.reviews-content"),this.$ugcPhotoContainer=t.find(".js-container.photos-content"),this.$ugcReviewIndex=t.find(".review-index"),this.$ugcContainer=this.$ugcReviewContainer,this.$ugcReviewsContent=t.find(".reviews-content"),this.$ugcPhotosContent=t.find(".photos-content"),this.$ugcReviewsHeading=o.find(".reviews-content-heading"),this.$ugcPhotosHeading=o.find(".photos-content-heading"),this.$ugcPrevButton=t.find(".ugc-review-prev"),this.$ugcNextButton=t.find(".ugc-review-next"),this.recipeId=t.data("id"),this.headline=t.data("headline"),this.legacyId=t.data("legacy-cms-id"),this.author=t.data("author"),this.reviewsCount=t.data("reviews-count")||0,this.photosCount=t.data("photos-count")||0,this.recipePage=t.data("page")||0,this.reviewsPage=1,this.reviewsReqt=!1,this.photosPage=1,this.photosReqt=!1,this.onClick=this.onClick.bind(this),this.onChange=this.onChange.bind(this),this.onReviewsUpdated=this.onReviewsUpdated.bind(this),this.settings=t.data(),this.trackingType=g.a.get(i,"tracking.type",{}),this.trackingData=g.a.get(i,"tracking.data",{}),this.options=g.a.defaults(this.settings,g.a.get(i,"carousel",{})),this.$ugcModal=n}return a()(e,[{key:"getReviews",value:function(){var e,t,i=this;if(0===this.recipePage&&((e=this.reviewsIds,t=this.$ugcReviewContainer,e.indexOf(function(e){return e.find(".owl-item.active>.component").attr("data-cms-id")}(t)))>=this.reviewsIds.length-4&&!this.reviewsReqt)){var n=c()(".ugc-reviews .sort-option.active").data("sort")||null;this.reviewsPage+=1;var s={id:this.recipeId,reviews_count:this.reviewsCount,page:this.reviewsPage,sort:n};this.reviewsReqt=!0,c.a.get(this.config.api.endpoints.reviews,s,(function(e){i.renderReviews(e.reviews),i.reviewsIds=m(i.$ugcReviewContainer),i.reviewsReqt=!1}))}}},{key:"getPhotos",value:function(){var e=this,t=this.getIndex(),i=t.index;if(t.isLast&&this.photosReqt&&this.$ugcNextButton.addClass("disabled"),i>=this.photosIds.length-4&&!this.photosReqt){var n={id:this.recipeId,photo_count:this.photosCount,page:this.photosPage,legacy_cms_id:this.legacyId};this.photosReqt=!0,c.a.get(this.config.api.endpoints.images,n,(function(t){e.renderPhotos(t.images),e.photosIds=m(e.$ugcPhotoContainer),e.photosReqt=!1,e.photosPage+=1,e.$ugcNextButton.removeClass("disabled")}))}}},{key:"renderReviews",value:function(e,t){var i=this;if(e){if(t){var n=e.join();this.$ugcReviewContainer.trigger("replace.owl.carousel",n),this.$ugcReviewContainer.trigger("refresh.owl.carousel"),this.reviewsPage=1,this.goToReview()}else e.forEach((function(e){return i.$ugcReviewContainer.trigger("add.owl.carousel",e)})),this.$ugcReviewContainer.trigger("refresh.owl.carousel");this.reviewsIds=m(this.$ugcReviewContainer)}}},{key:"renderPhotos",value:function(e){var t=this;e&&(e.forEach((function(e){return t.$ugcPhotoContainer.trigger("add.owl.carousel",e)})),this.$ugcPhotoContainer.trigger("refresh.owl.carousel"))}},{key:"showReviews",value:function(){this.trackingType="reviews",this.$ugcReviewsContent.show(),this.$ugcPhotosContent.hide(),this.$ugcReviewsHeading.show(),this.$ugcPhotosHeading.hide(),this.$ugcReviews.find(".component.recipe-reviews-sort").show()}},{key:"showPhotos",value:function(){this.trackingType="photos",this.$ugcReviewsContent.hide(),this.$ugcPhotosContent.show(),this.$ugcReviewsHeading.hide(),this.$ugcPhotosHeading.show(),this.$ugcReviews.find(".component.recipe-reviews-sort").hide()}},{key:"goToReview",value:function(e){this.showReviews(),this.$ugcContainer=this.$ugcReviewContainer;var t=e?this.getIndex(e).index:0;this.$ugcContainer.trigger("to.owl.carousel",[t,0,!0]),this.updateIndex(),this.segmentPage(e)}},{key:"goToPhoto",value:function(e){this.showPhotos(),this.$ugcContainer=this.$ugcPhotoContainer;var t=this.getIndex(e).index;this.$ugcContainer.trigger("to.owl.carousel",[t,0,!0]),this.updateIndex(),this.segmentPage(e)}},{key:"getIndex",value:function(e){var t=this.$ugcContainer.find(".owl-item:not(.cloned)>.component"),i=this.$ugcContainer.find(".owl-item.active>.component"),n=e?t.get().findIndex((function(t){return e===t.dataset.cmsId})):t.get().indexOf(i.get(0));return{index:n<0?0:n,isLast:n===t.length-1,itemCount:t.length}}},{key:"handleEvents",value:function(){u()(l.o).subscribe(this.onClick),u()(l.db).subscribe(this.onChange),u()(l.qb).subscribe(this.onReviewsUpdated),u()(l.hc).subscribe((function(e){c()(".recipe-reviewed-items").prepend(e.html)}))}},{key:"refreshModalAds",value:function(){window.karma=window.karma||{};var e=g.a.get(this,"$ugcModal.adData.slotIds",[]);window.karma.cmd.push((function(){window.karma.refresh(e)}))}},{key:"handlePrev",value:function(){return this.$ugcContainer.trigger("prev.owl.carousel"),this.refreshModalAds(),this.updateIndex()}},{key:"handleNext",value:function(){return this.$ugcContainer.trigger("next.owl.carousel"),this.refreshModalAds(),this.updateIndex()}},{key:"onClick",value:function(e,t){return Object(w.a)(t,this.$ugcPrevButton)&&!this.$ugcPrevButton.hasClass("disabled")?(this.handlePrev(),this.trackPage()):Object(w.a)(t,this.$ugcNextButton)&&!this.$ugcNextButton.hasClass("disabled")?(this.handleNext(),this.trackPage()):null}},{key:"onChange",value:function(e,t){return Object(w.a)(t,this.$ugcContainer)&&u()(l.zb).broadcast(),null}},{key:"updateIndex",value:function(){var e=this.getIndex().index;"reviews"===this.$ugcContainer.data("type")?(this.$ugcReviewIndex.text(e+1),this.togglePrevButtonDisabled(e),this.getReviews()):(this.togglePrevButtonDisabled(e),this.getPhotos())}},{key:"togglePrevButtonDisabled",value:function(e){e?this.$ugcPrevButton.removeClass("disabled"):this.$ugcPrevButton.addClass("disabled")}},{key:"onReviewsUpdated",value:function(e,t){this.renderReviews(e,t)}},{key:"trackPage",value:function(){var e=this.$ugcReviews.find(".owl-item.active .recipe-review-wrapper").data("cms-id");this.segmentPage(e)}},{key:"segmentPage",value:function(e){var t="reviews"===this.trackingType?this.trackingData.reviews:this.trackingData.photos;p.a.page({contentType:t.contentType,contentCmsId:e,linkedCmsId:this.$ugcReviews.data("id"),meredithApplication:"Front End Modal",path:"".concat(window.location.pathname).concat(t.path,"/").concat(e)})}},{key:"initializeReviewsCarousel",value:function(){this.$ugcReviewContainer.addClass("owl-carousel"),this.$ugcReviewContainer.owlCarousel(this.options)}},{key:"initializePhotosCarousel",value:function(){this.$ugcPhotoContainer.addClass("owl-carousel"),this.$ugcPhotoContainer.owlCarousel(this.options)}},{key:"init",value:function(){return this.initializeReviewsCarousel(),this.initializePhotosCarousel(),this.reviewsIds=m(this.$ugcReviewContainer),this.photosIds=m(this.$ugcPhotoContainer),this.handleEvents()}}]),e}(),$={api:{endpoints:{reviews:Object(f.a)("/element-api/content-proxy/reviews"),images:Object(f.a)("/element-api/content-proxy/images")}},carousel:{loop:!0,items:1,nav:!1,dots:!1,center:!0,lazyLoad:!0,lazyPrefetch:4,autoHeight:!0,addClassActive:!0,paginationSpeed:100,responsiveRefreshRate:100,mouseDrag:!1,touchDrag:!0,smartSpeed:200},tracking:{type:"reviews",data:{reviews:{contentType:"Reviews",path:"/reviews"},photos:{contentType:"Recipe Photos",path:"/photos"}}}};t.default=function(){var e=c()(".modal.ugc-modal"),t=new v.a(e,"ugc-modal"),i=new C(c()(".component.ugc-reviews"),$,t,e);return u()(l.o).subscribe((function(e,n){var s=c()(".ugc-reviews-link"),o=c()(".ugc-photos-link"),a=c()(".ugc-upload-button"),r=c()(".image-container.ugc-upload-button"),h=c()(".icon-image-zoom"),d=c()(".allowPopup"),g=c()(".recipe-review-helpful");if(Object(w.a)(n,g)){if(e.preventDefault(),n.parent().closest(".recipe-review-helpful").hasClass("fired"))return!0;!function(e,t){if(c()("body").hasClass("authenticated")){var i=e,n={id:c()("body").data("content-graph-id"),reviewId:i,type:"post"};c.a.ajax({url:"/element-api/content-proxy/helpful",type:"POST",data:n,cache:!1,success:function(e,i,n){if(200===n.status&&!t.parent().closest(".review-helpful-active").hasClass("fired")){t.parent().closest(".review-helpful-active").addClass("fired");var s=t.parent().find(".helpful-count").html();s=s&&""!==s?parseInt(s,10)+1:1,t.parent().find(".helpful-count").html(s)}}})}else{var s=c()(".component.recipe-ingredients").data("login-url");s="".concat(s),window.open(s)}}(n.closest(".component.ugc-review").attr("data-cms-id"),n)}if(Object(w.a)(n,s)){e.preventDefault(),t.adData.targeting.type="reviews",t.open();var v=c()(".recipe-reviewed-items").prev().find(".sort-option.active").index();c()(".component.ugc-reviews").find(".sort-options a:eq(".concat(v,")")).trigger("click"),setTimeout((function(){var e=n.closest(".component.ugc-review").attr("data-cms-id");i.goToReview(e)}),200)}if(Object(w.a)(n,o)&&!Object(w.a)(n,h)&&!Object(w.a)(n,d)){var p=n.find(".recipe-play-button a");if(p.length)window.location=p.attr("href");else if(0!==c()(".image-filmstrip").length&&0!==c()(".image-filmstrip").find(".image-slide").length){e.preventDefault(),t.adData.targeting.type="photos",t.open();var f=n.closest(".ugc-photos-link").attr("data-cms-id")||n.closest(".component.ugc-review").attr("data-cms-id");i.goToPhoto(f)}}return Object(w.a)(n,a)&&u()(l.lc).broadcast(e,n),Object(w.a)(n,r)&&u()(l.lc).broadcast(e,n),null})),i.init()}},791:function(e,t,i){"use strict";i.d(t,"a",(function(){return r}));var n=i(2),s=i.n(n),o=i(1),a=i.n(o);function r(e){return a()(document.body).data("add-slash")&&!s.a.endsWith(e,"/")?"".concat(e,"/"):e}}}]);
//# sourceMappingURL=69-a7563451.js.map