(window.webpackJsonp=window.webpackJsonp||[]).push([[65],{296:function(e,t,a){"use strict";a.r(t);var o=a(779),n=a.n(o),s=a(780),i=a.n(s),r=a(1),c=a.n(r),u=a(5),d=a.n(u),l=a(4),g=a(803),m=a(791),f=a(907);function p(e,t){e[0].target.classList.contains("authenticated")&&sessionStorage.removeItem("commentLogin"),e[0].target.classList.contains("modal-active")&&(sessionStorage.removeItem("ratingValue"),t.disconnect())}function h(e){var t=sessionStorage.getItem(e),a=document.querySelector(".ugc-comments-content-container");if(t&&a){var o=a.getBoundingClientRect().top-document.querySelector("header.navigation-test").offsetHeight;window.scrollBy(0,o),function(e){var t=sessionStorage.getItem(e),a=document.getElementById("project-ratings");t&&a&&(c()(".ugc-comments-add-comment").trigger("click"),document.querySelector(".ugc-upload-modal").querySelector("input[value=".concat(t,"]")).checked=!0)}("ratingValue"),new MutationObserver(p).observe(document.body,{attributes:!0})}}var v=function(){function e(t){n()(this,e),this.$context=t,this.$modal=t.closest(".partial.modal"),this.$form=t.find("form"),this.$alert=t.find(".alert-banner");var a=t.closest(".ugc-upload-reply-modal");a.length?(this.$trigger=c()(".ugc-comments-reply-button"),this.ugcUploadModal=new g.a(a,"ugc-upload-reply-modal")):(this.$trigger=c()(".recipe-review-add-review, .ugc-comments-add-comment, .ugc-photos-upload-photo"),this.ugcUploadModal=new g.a(t.closest(".ugc-upload-modal"),"ugc-upload-modal")),this.useUGCManager=!!this.$form.closest(".ugc-upload").data("ugc-manager")&&this.$form.closest(".ugc-upload").data("ugc-manager"),this.ugcType=this.$trigger.hasClass("recipe-review-add-review")&&!this.useUGCManager?"review":"comments",h("commentLogin")}return i()(e,[{key:"showError",value:function(e){this.$alert.removeClass("hidden"),this.$alert.find(".alert-text").text(e)}},{key:"hideError",value:function(){this.$alert.addClass("hidden"),this.$alert.find(".alert-text").text("")}},{key:"uploadComment",value:function(e,t){var a=this,o=Object(m.a)("/element-api/content-proxy/comment"),n=e;n.title=this.$context.data("headline"),(n.text||n.rating)&&c.a.post(o,n,(function(e,t){if("success"===t){a.$context.addClass("submitted"),a.$modal.addClass("success"),a.hideError();var o=c()("textarea",a.$form);o.length&&o.val(""),n.text&&d()(l.hc).broadcast(e,n),n.rating&&d()(l.ic).broadcast(e,n)}})).fail((function(o){500!==o.status||t?a.showError("An error has occurred."):500!==o.status||t||Object(f.a)(a.uploadComment.bind(a),[e])}))}},{key:"uploadReview",value:function(e,t){var a=this,o=Object(m.a)("/element-api/content-proxy/review");c.a.post(o,e,(function(t,o){if("success"===o){a.$context.addClass("submitted"),a.$modal.addClass("success");var n={label:"Rating Submitted"};e.text&&(n.label="Review Submitted"),d()(l.ec).broadcast(n),a.hideError()}})).fail((function(o){500!==o.status||t?a.showError("An error has occurred."):500!==o.status||t||Object(f.a)(a.uploadReview.bind(a),[e])}))}},{key:"events",value:function(){var e=this;document.body.addEventListener(l.e,(function(t){var a=sessionStorage.getItem("ratingValue"),o=sessionStorage.getItem("commentLogin"),n=sessionStorage.getItem("userRecipeLogin");(a||o||n)&&setTimeout(d()(l.lc).broadcast(t,e.$trigger),0)})),d()(l.lc).subscribe((function(t,a){if(c()("body").hasClass("authenticated"))t.preventDefault(),e.pid=a.data("tid")?a.data("tid"):"0","review"===e.ugcType&&e.$form.trigger("reset"),e.$context.removeClass("submitted"),e.$modal.removeClass("success"),e.hideError(),e.ugcUploadModal.open(),d()(l.Lb).broadcast(e.ugcUploadModal.$modal,a.closest(".rating-star").data("rating")),window.ugcUploadModal=e.ugcUploadModal;else if(sessionStorage.setItem("commentLogin",!0),!a.closest(".embedded-auth-modal-trigger").length){var o=a.closest(e.$trigger).data("login-url")||a.data("login-url")||a.closest("button").data("login-url");window.open(o,"_self")}})),d()(l.o).subscribe((function(t,a){a.closest(e.$trigger).length&&d()(l.lc).broadcast(t,a),a.hasClass("embedded-auth-modal-trigger")&&a.hasClass("ugc-upload-button")&&sessionStorage.setItem("userRecipeLogin",!0)})),d()(l.Qb).subscribe((function(t,a){if(a.closest(e.$form).length){t.preventDefault();var o=e.$form.find("input[name=ugc-rating]:checked").val()||e.$form.find("input[name=ugc-comments-rating]:checked").val(),n=o,s=e.$form.find("textarea[name=ugc-text]").val()?e.$form.find("textarea[name=ugc-text]").val():"",i=e.$form.closest(".ugc-upload"),r=i.data("review"===e.ugcType?"cms-id":"uuid"),u=i.data("ugc-type")||"ugc-comment",d=e.$context.find(".ugc-upload-rating").length,l=e.pid,g=c()("body")[0].className.match(/(^|\s+)template-(\S*)/)[2];o&&r&&"review"===e.ugcType?e.uploadReview({rating:o,text:s,id:r}):d&&!o||!r?e.showError("Please select a rating."):s||d?e.uploadComment({rating:o,level_of_difficulty:n,text:s,id:r,pid:l,_type:u,template:g}):e.showError("Please enter a comment.")}}))}},{key:"init",value:function(){this.events()}}]),e}();t.default=function(){c()(".component.ugc-upload").each((function(){new v(c()(this)).init()}))}},791:function(e,t,a){"use strict";a.d(t,"a",(function(){return r}));var o=a(2),n=a.n(o),s=a(1),i=a.n(s);function r(e){return i()(document.body).data("add-slash")&&!n.a.endsWith(e,"/")?"".concat(e,"/"):e}},907:function(e,t,a){"use strict";a.d(t,"a",(function(){return d}));var o=a(126),n=a.n(o),s=a(2),i=a.n(s),r=a(1),c=a.n(r),u=a(791);function d(e,t){var a=Object(u.a)("/element-api/content-proxy/refresh-cookie");c.a.ajax({url:a,retry:!1,type:"GET",timeout:3e3,xhrFields:{withCredentials:!0},success:function(a){i.a.isArray(a)&&"function"==typeof e&&(i.a.forEach(a,(function(e){document.cookie=e})),e.apply(void 0,n()(t).concat([!0])))}})}}}]);
//# sourceMappingURL=65-91c88550.js.map